---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# bdsm

<!-- badges: start -->
<!-- badges: end -->

The goal of bdsm is to provide tools to model panel data.

## Installation

You can install the released version of bdsm from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("bdsm")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("mateuszwyszynski/bdsm")
```

## Basic Usage

```{r}
library(magrittr)
devtools::load_all()

set.seed(20)

# STEP 1 - Data Preparation
#
# Features are scaled and centralized around the mean.
# Then they are centralized around the mean within cross-sections (fixed time effects)
data_prepared <- bdsm::economic_growth[,1:7] %>%
  feature_standardization(timestamp_col = year, entity_col = gdp) %>%
  feature_standardization(timestamp_col = year, entity_col = country,
                          time_effects = TRUE, scale = FALSE)

# If needed track computation time
library(tictoc)
tic()

# STEP 2 - BMA Analysis

for_bma <-
  bma_prep(df = data_prepared, timestamp_col = year, entity_col = country,
           dep_var_col = gdp, init_value = 0.5, exact_value = FALSE)

bma_result <- bma(for_bma = for_bma, df = data_prepared)

print(paste("Computation Time:", toc()))
tic()
```

## Troubleshooting

1. Cannot install required packages / setup renv environment

Make sure to go through the displayed errors.
The problem might be connected to your OS environment.
E.g. you might see an information like the following:

```
Configuration failed to find one of freetype2 libpng libtiff-4 libjpeg. Try installing:
 * deb: libfreetype6-dev libpng-dev libtiff5-dev libjpeg-dev (Debian, Ubuntu, etc)
 * rpm: freetype-devel libpng-devel libtiff-devel libjpeg-devel (Fedora, CentOS, RHEL)
 * csw: libfreetype_dev libpng16_dev libtiff_dev libjpeg_dev (Solaris)
```

In such case you should first try installing the recommended packages.
With properly configured system environment everything should work fine.


## Advanced Usage: parallel computing

```{r}
# To find the optimal model space with parallel computations
# replace the STEP 2 with:
library(parallel)
cl <- safeMakeCluster()
setDefaultCluster(cl)

for_bma <-
  bma_prep(df = data_prepared, timestamp_col = year, entity_col = country,
           dep_var_col = gdp, init_value = 0.5, exact_value = FALSE,
           run_parallel = TRUE)

bma_result <- bma(for_bma = for_bma, df = data_prepared)

stopCluster(cl = NULL)
```
